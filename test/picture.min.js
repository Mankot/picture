/* Picture - Picture element polyfill for responsive images. Authors & copyright (c) 2012: WebLinc, David Knight. */
/* NOTE: Depends on Media object. See https://github.com/weblinc/media-match */

(function(c){var s=c.document,l=0,t=/\b[\d\.]+x\b/g,u=/[^\s]+/g,m=Media.features.resolution;_timer=0;c.Picture={pictures:[],parse:function(){Picture.pictures=[];for(var c=s.getElementsByTagName("object"),a=c.length,b=null;a--&&(b=c[a]);)if(null!==b.getAttribute("data-picture")){for(var f=b.getElementsByTagName("param"),d=f.length,g=null,h="",n={},j="",e="",p="";d--&&(g=f[d]);){j=g.getAttribute("data-media");if(!(e=g.getAttribute("data-src")))a:{for(var e=g.getAttribute("data-srcset")||"",q=e.match(t)||
[],k=q.length;k--;){var r=96*parseFloat(q[k]);if(m===r||Math.floor(m)===Math.floor(r)){e=e.match(u)[2*(k%2)];break a}}e=null}j&&e?(n[j]=e,h+=(h.length?", ":"")+j):e&&(p=e)}Picture.pictures.push({element:b,media:h,src:n,srcDefault:p,matches:!1});l++}},watch:function(){clearTimeout(_timer);_timer=setTimeout(function(){var c=l;do{var a=Picture.pictures[c],b=null,f=null,d=!1;"undefined"!==typeof a&&((d=Media.parseMatch(a.media,!0))&&a.matches!==d.media||!d&&a.srcDefault?(a.matches=d&&d.media||d,f=(b=
a.element.getElementsByTagName("img")[0])&&b.getAttribute("src")||"",b||(b=document.createElement("img"),b.alt=a.element.getAttribute("title"),a.element.appendChild(b)),Picture.imageError(b,a,f),b.src=d.media&&a.src[d.media]||a.srcDefault):d||(a.matches=!1,a.srcDefault&&(b=a.element.getElementsByTagName("img")[0])&&a.element.removeChild(b)))}while(c--)},10)},imageError:function(c,a,b){c.onerror=function(){(a.srcDefault=b)&&(this.src=b);this.onerror=null}},init:function(){Picture.parse();Picture.watch();
Media.listen(Picture.watch)}};c.addEventListener?c.addEventListener("load",c.Picture.init):c.attachEvent("onload",c.Picture.init)})(window);